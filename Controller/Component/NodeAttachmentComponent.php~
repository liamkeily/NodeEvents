<?php

App::uses('Component', 'Controller');

/**
 * Note Attachments Component
 *
 * @author Liam Keily
 * @package Croogo.NodeAttachments.Controller.Component
 */
class NodeAttachmentComponent extends Component {
	
	public function startup(Controller $controller){
		
		
		$controller->helpers[] = 'NodeAttachments.Attachment';
		
		Croogo::hookAdminTab('Nodes/admin_add','Attachments','NodeAttachments.NodeAttachment');
		Croogo::hookAdminTab('Nodes/admin_edit','Attachments','NodeAttachments.NodeAttachment');
		
		
		if (!empty($controller->request->data['NodeAttachment'])) {
		
			foreach ($controller->request->data['NodeAttachment'] as $uuid => $fields) {
				foreach ($fields as $field => $vals) {
					$controller->Security->unlockedFields[] = 'NodeAttachment.' . $uuid . '.' . $field;
				}
			}
			
			print_R($controller->Security->unlockedFields);
			
		
		}

		print_r($controller->request->data);
		//$attachmentsTree = $controller->NodeAttachments->generateTreeList();

		//print_r($attachmentsTree);
		
	}

}
